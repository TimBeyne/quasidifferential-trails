import common

# 6 rounds (weight 13)
diffs = [
    (0x0211, 0x0A04),
    (0x2800, 0x0010),
    (0x0040, 0x0000),
    (0x8000, 0x8000),
    (0x8100, 0x8102),
    (0x8000, 0x840A),
    (0x850A, 0x9520)
]
# 7 rounds (weight 18)
#diffs = [
#    (0x0A60, 0x4205),
#    (0x0211, 0x0A04),
#    (0x2800, 0x0010),
#    (0x0040, 0x0000),
#    (0x8000, 0x8000),
#    (0x8100, 0x8102),
#    (0x8000, 0x840A),
#    (0x850A, 0x9520)
#]
# 8 rounds (weight 24)
#diffs = [
#    (0x1488, 0x1008),
#    (0x0021, 0x4001),
#    (0x0601, 0x0604),
#    (0x1800, 0x0010),
#    (0x0040, 0x0000),
#    (0x8000, 0x8000),
#    (0x8100, 0x8102),
#    (0x8000, 0x840A),
#    (0x850A, 0x9520)
#]
# 8 rounds (second characteristic)
#diffs = [
#    (0x1488, 0x1008),
#    (0x0021, 0x4001),
#    (0x0E01, 0x0E04),
#    (0x3800, 0x0010),
#    (0x0040, 0x0000),
#    (0x8000, 0x8000),
#    (0x8100, 0x8102),
#    (0x8000, 0x840A),
#    (0x850A, 0x9520)
#]

# 9 rounds (weight 30)
#diffs = [
#    (0x8054, 0xA900),
#    (0x0000, 0xA402),
#    (0xA402, 0x3408),
#    (0x50C0, 0x80E0),
#    (0x0181, 0x0203),
#    (0x000C, 0x0800),
#    (0x2000, 0x0000),
#    (0x0040, 0x0040),
#    (0x8040, 0x8140),
#    (0x0040, 0x0542)
#]
# 9 rounds (second characteristic, weight 33)
# diffs = [
#     (0x8054, 0xA900),
#     (0x0000, 0xA402),
#     (0xE402, 0x7408),
#     (0x5040, 0x8061),
#     (0x0381, 0x0207),
#     (0x001C, 0x0800),
#     (0x2000, 0x0000),
#     (0x0040, 0x0040),
#     (0x8040, 0x8140),
#     (0x0040, 0x0542)  
# ]
# 9 rounds (third characteristic, weight 33)
#diffs = [
#    (0x8054, 0xA900),
#    (0x0000, 0xA402),
#    (0xAC02, 0x3C08),
#    (0x70C0, 0x80E0),
#    (0x0181, 0x0203),
#    (0x000C, 0x0800),
#    (0x2000, 0x0000),
#    (0x0040, 0x0040),
#    (0x8040, 0x8140),
#    (0x0040, 0x0542)
#]

word_size = 16
max_weight_loss = 6

sols = []
btor, weight = common.speck_quasidifferential_trails(diffs, word_size)
for w in range(max_weight_loss):
    for solution in common.solve_all(btor, weight, w, len(diffs) - 1, word_size):
        sols.append((w, solution))

print("Characteristic:")
for (a, b) in diffs:
    print(" " * 4, "{:04x} {:04x}".format(a, b))

for (weight, solution) in sols:
    s = common.compute_sign_speck(diffs, solution, word_size)
    print("Weight: {} [{:+}]".format(weight, s))
    for (u, v) in solution:
        print(" " * 4, "{:04x} {:04x}".format(u, v))
