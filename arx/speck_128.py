import common

# 20 rounds (weight 128)
diffs = [
    (0x0124000400000000, 0x0801042004000000),
    (0x0800202000000000, 0x4808012020000000),
    (0x4800010000000000, 0x0840080100000002),
    (0x0808080000000006, 0x4A08480800000016),
    (0x4000400000000032, 0x1042004000000080),
    (0x0202000000000080, 0x8012020000000480),
    (0x0010000000000480, 0x0080100000002084),
    (0x8080000000002080, 0x84808000000124A0),
    (0x0400000000012440, 0x2004000000080144),
    (0x2000000000080220, 0x2020000000480801),
    (0x0000000000480001, 0x0100000002084008),
    (0x000000000E080808, 0x080000001E4A0848),
    (0x00000000F2400040, 0x4000000000104200),
    (0x0000000000820200, 0x0000000000001202),
    (0x0000000000009000, 0x0000000000000010),
    (0x0000000000000080, 0x0000000000000000),
    (0x8000000000000000, 0x8000000000000000),
    (0x8080000000000000, 0x8080000000000004),
    (0x8000800000000004, 0x8400800000000020),
    (0x8080808000000020, 0xA084808000000124),
    (0x8004000080000124, 0x8420040080000801)
]

#diffs = [
#    (0x0124000400000000, 0x0801042004000000),
#    (0x0800202000000000, 0x4808012020000000),
#    (0x4800010000000000, 0x0840080100000002),
#    (0x0808080000000006, 0x4A08480800000016),
#    (0x4000400000000032, 0x1042004000000080),
#    (0x0202000000000080, 0x8012020000000480),
#    (0x0010000000000480, 0x0080100000002084),
#    (0x8080000000006080, 0x84808000000164A0),
#    (0x0400000000032400, 0x2004000000080104),
#    (0x2000000000080020, 0x2020000000480801),
#    (0x0000000000480001, 0x0100000002084008),
#    (0x000000000E080808, 0x080000001E4A0848),
#    (0x00000000F2400040, 0x4000000000104200),
#    (0x0000000000820200, 0x0000000000001202),
#    (0x0000000000009000, 0x0000000000000010),
#    (0x0000000000000080, 0x0000000000000000),
#    (0x8000000000000000, 0x8000000000000000),
#    (0x8080000000000000, 0x8080000000000004),
#    (0x8000800000000004, 0x8400800000000020),
#    (0x8080808000000020, 0xA084808000000124),
#    (0x8004000080000124, 0x8420040080000801)
#]
#
#diffs = [
#    (0x0124000400000000, 0x0801042004000000),           
#    (0x0800202000000000, 0x4808012020000000),           
#    (0x4800010000000000, 0x0840080100000002),           
#    (0x0808080000000002, 0x4A08480800000012),           
#    (0x4400400000000012, 0x1442004000000080),           
#    (0x2202000000000080, 0x8012020000000480),           
#    (0x0010000000000480, 0x0080100000002084),           
#    (0x8080000000006080, 0x84808000000164A0),           
#    (0x0400000000032400, 0x2004000000080104),           
#    (0x2000000000080020, 0x2020000000480801),           
#    (0x0000000000480001, 0x0100000002084008),           
#    (0x000000000E080808, 0x080000001E4A0848),           
#    (0x00000000F2400040, 0x4000000000104200),           
#    (0x0000000000820200, 0x0000000000001202),           
#    (0x0000000000009000, 0x0000000000000010),           
#    (0x0000000000000080, 0x0000000000000000),           
#    (0x8000000000000000, 0x8000000000000000),           
#    (0x8080000000000000, 0x8080000000000004),           
#    (0x8000800000000004, 0x8400800000000020),           
#    (0x8080808000000020, 0xA084808000000124),           
#    (0x8004000080000124, 0x8420040080000801)
#]
#
#diffs = [
#    (0x0124000400000000, 0x0801042004000000),
#    (0x0800202000000000, 0x4808012020000000),
#    (0x4800010000000000, 0x0840080100000002),
#    (0x0808080000000002, 0x4A08480800000012),
#    (0x4400400000000012, 0x1442004000000080),
#    (0x2202000000000080, 0x8012020000000480),
#    (0x0010000000000480, 0x0080100000002084),
#    (0x8080000000002080, 0x84808000000124A0),
#    (0x0400000000012440, 0x2004000000080144),
#    (0x2000000000080220, 0x2020000000480801),
#    (0x0000000000480001, 0x0100000002084008),
#    (0x000000000E080808, 0x080000001E4A0848),
#    (0x00000000F2400040, 0x4000000000104200),
#    (0x0000000000820200, 0x0000000000001202),
#    (0x0000000000009000, 0x0000000000000010),
#    (0x0000000000000080, 0x0000000000000000),
#    (0x8000000000000000, 0x8000000000000000),
#    (0x8080000000000000, 0x8080000000000004),
#    (0x8000800000000004, 0x8400800000000020),
#    (0x8080808000000020, 0xA084808000000124),
#    (0x8004000080000124, 0x8420040080000801)
#]

word_size = 64
max_weight_loss = 2

sols = []
btor, weight = common.speck_quasidifferential_trails(diffs, word_size)
for w in range(max_weight_loss):
    for solution in common.solve_all(btor, weight, w, len(diffs) - 1, word_size):
        sols.append((w, solution))

print("Characteristic:")
for (a, b) in diffs:
    print(" " * 4, "{:032x} {:032x}".format(a, b))

for (weight, solution) in sols:
    s = common.compute_sign_speck(diffs, solution, word_size)
    print("Weight: {} [{:+}]".format(weight, s))
    for (u, v) in solution:
        print(" " * 4, "{:032x} {:032x}".format(u, v))
